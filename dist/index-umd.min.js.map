{"version":3,"file":"index-umd.min.js","sources":["../src/iframePost.js","../src/SharedStorage.js"],"sourcesContent":["export const iframePost = (iframeSource, msgObj, {\n  origin = new URL(iframeSource).origin,\n  loaded\n} = {}) => {\n  const iframe = document.createElement('iframe');\n  iframe.style.display = 'none';\n  iframe.addEventListener('load', (e) => {\n    if (loaded) {\n      loaded(e);\n    }\n    iframe.contentWindow.postMessage(msgObj, origin);\n    // iframe.remove(); // Won't receive message back (in Firefox or Chrome)\n  });\n  iframe.src = iframeSource;\n  document.body.append(iframe);\n};\n","import {iframePost} from './iframePost.js';\n\n// This is for user API (to be built-in to the browser but as module for now)\nconst iframeSource = 'https://unpkg.com/sharedstorage/index.html'; // 'http://localhost:8051'; // 'https://shared-storage.org';\nconst promises = {};\nlet id = 1;\nconst iframePostPromise = (msgObj) => {\n  return new Promise((resolve, reject) => {\n    iframePost(iframeSource, Object.assign(msgObj, {id, isSharedStorage: true}));\n    promises[id++] = {resolve, reject};\n  });\n};\n\nwindow.addEventListener('message', (e) => {\n  if (!e.data.id) {\n    return;\n  }\n  if (e.data.status === 'error') {\n    promises[e.data.id].reject(e.data);\n  } else {\n    promises[e.data.id].resolve(e.data);\n  }\n});\n\nwindow.SharedStorage = {\n  async getItem ({namespace, namespacing}) {\n    return iframePostPromise({\n      namespacing,\n      namespace,\n      method: 'getItem'\n    });\n  },\n  /*\n  Todo:\n  length,\n  key,\n  clear,\n  async removeItem ({namespace, namespacing}) {\n    return iframePostPromise({\n      namespacing,\n      namespace,\n      method: 'remove'\n    });\n  },\n  */\n  async getMaxRemaining () {\n    return iframePostPromise({\n      method: 'getMaxRemaining'\n    });\n  },\n  async setItem ({data, namespace, namespacing}) {\n    return iframePostPromise({\n      namespacing,\n      namespace,\n      data,\n      method: 'setItem'\n    });\n  }\n};\n"],"names":["promises","id","iframePostPromise","msgObj","Promise","resolve","reject","iframeSource","origin","URL","loaded","iframe","document","createElement","style","display","addEventListener","e","contentWindow","postMessage","src","body","append","iframePost","Object","assign","isSharedStorage","window","data","status","SharedStorage","namespace","namespacing","method"],"mappings":"uJAAO,MCIDA,EAAW,GACjB,IAAIC,EAAK,EACT,MAAMC,EAAqBC,GAClB,IAAIC,QAAQ,CAACC,EAASC,KDPL,EAACC,EAAcJ,GACvCK,OAAAA,EAAS,IAAIC,IAAIF,GAAcC,OAC/BE,OAAAA,GACE,YACIC,EAASC,SAASC,cAAc,UACtCF,EAAOG,MAAMC,QAAU,OACvBJ,EAAOK,iBAAiB,OAASC,IAC3BP,GACFA,EAAOO,GAETN,EAAOO,cAAcC,YAAYhB,EAAQK,KAG3CG,EAAOS,IAAMb,EACbK,SAASS,KAAKC,OAAOX,ICNnBY,CALiB,6CAKQC,OAAOC,OAAOtB,EAAQ,CAACF,GAAAA,EAAIyB,iBAAiB,KACrE1B,EAASC,KAAQ,CAACI,QAAAA,EAASC,OAAAA,KAI/BqB,OAAOX,iBAAiB,UAAYC,IAC7BA,EAAEW,KAAK3B,KAGU,UAAlBgB,EAAEW,KAAKC,OACT7B,EAASiB,EAAEW,KAAK3B,IAAIK,OAAOW,EAAEW,MAE7B5B,EAASiB,EAAEW,KAAK3B,IAAII,QAAQY,EAAEW,SAIlCD,OAAOG,cAAgB,SACrB,OAAeC,UAACA,EAADC,YAAYA,KAClB9B,EAAkB,CACvB8B,YAAAA,EACAD,UAAAA,EACAE,OAAQ,4BAgBZ,SACS/B,EAAkB,CACvB+B,OAAQ,4BAGZ,OAAeL,KAACA,EAADG,UAAOA,EAAPC,YAAkBA,KACxB9B,EAAkB,CACvB8B,YAAAA,EACAD,UAAAA,EACAH,KAAAA,EACAK,OAAQ"}